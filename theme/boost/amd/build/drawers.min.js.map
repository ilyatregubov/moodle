{"version":3,"sources":["../src/drawers.js"],"names":["backdropPromise","pageWrapper","document","getElementById","page","Sizes","medium","large","getBackdrop","Templates","render","then","html","ModalBackdrop","fail","Notification","exception","closeDrawer","pageDrawer","toggleButton","closeBackdrop","preference","getAttribute","state","Aria","hide","classList","remove","isMedium","M","util","set_user_preference","backdrop","style","overflow","catch","showDrawer","unhide","add","window","console","log","show","getRoot","addEventListener","trigger","dispatchEvent","CustomEvent","bubbles","detail","DomRect","body","getBoundingClientRect","x","width","isLarge","activateDrawer","closeButton","querySelector","contains","focus","e","setAttribute","scroller","drawerLayout","scrollTop","innerHeight","init","drawers","querySelectorAll","forEach","hasAttribute"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Toggling the visibility of the secondary navigation on mobile.\n *\n * @package    theme_boost\n * @copyright  2021 Bas Brands\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport ModalBackdrop from 'core/modal_backdrop';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport * as Aria from 'core/aria';\n\nlet backdropPromise = null;\nconst pageWrapper = document.getElementById('page-wrapper');\nconst page = document.getElementById('page');\n\n/**\n * Maximum sizes for breakpoints. This needs to correspond with Bootstrap\n * Breakpoints\n */\nconst Sizes = {\n    medium: 991,\n    large: 1200\n};\n\n/**\n * Add a backdrop to the page.\n * @return {Promise} rendering of modal backdrop.\n */\nconst getBackdrop = () => {\n    if (!backdropPromise) {\n        backdropPromise = Templates.render('core/modal_backdrop', {})\n            .then(html => {\n                return new ModalBackdrop(html);\n            })\n            .fail(Notification.exception);\n    }\n    return backdropPromise;\n};\n\n/**\n * Close the drawer\n *\n * @param {DOMElement} pageDrawer The drawer to close.\n * @param {DOMElement} toggleButton The button toggling the drawer.\n * @param {Bool} closeBackdrop Remove the backdrop on closing.\n */\nconst closeDrawer = (pageDrawer, toggleButton, closeBackdrop = true) => {\n    const preference = toggleButton.getAttribute('data-preference');\n    const state = toggleButton.getAttribute('data-state');\n    Aria.hide(pageDrawer);\n    pageDrawer.classList.remove('show');\n\n    if (state) {\n        page.classList.remove(state);\n    }\n    if (!isMedium() && preference) {\n        M.util.set_user_preference(preference, false);\n    }\n\n    if (isMedium() && closeBackdrop) {\n        getBackdrop().then(backdrop => {\n            backdrop.hide();\n            pageWrapper.style.overflow = 'auto';\n            return null;\n        }).catch(Notification.exception);\n    }\n};\n\n/**\n * Show the drawer\n *\n * @param {DOMElement} pageDrawer The drawer to open.\n * @param {DOMElement} toggleButton The button toggling the drawer.\n */\nconst showDrawer = (pageDrawer, toggleButton) => {\n    const preference = toggleButton.getAttribute('data-preference');\n    const state = toggleButton.getAttribute('data-state');\n\n    Aria.unhide(pageDrawer);\n    pageDrawer.classList.add('show');\n\n    if (!isMedium() && preference) {\n        M.util.set_user_preference(preference, true);\n    }\n\n    if (state) {\n        page.classList.add(state);\n    }\n\n    if (isMedium()) {\n        window.console.log('showbackdrop');\n        getBackdrop().then(backdrop => {\n            backdrop.show();\n            pageWrapper.style.overflow = 'hidden';\n            backdrop.getRoot()[0].addEventListener('click', () => {\n                closeDrawer(pageDrawer);\n            });\n            return null;\n        }).catch(Notification.exception);\n    }\n\n    const trigger = pageDrawer.getAttribute('data-trigger');\n    if (trigger) {\n        pageDrawer.dispatchEvent(new CustomEvent('show-boost-drawer', {bubbles: true, detail: trigger}));\n    }\n};\n\n/**\n * Check if the user uses a medium size browser.\n * @returns {Bool} true if the body is smaller than Sizes.medium max size.\n */\nconst isMedium = () => {\n    const DomRect = document.body.getBoundingClientRect();\n    return (DomRect.x + DomRect.width) <= Sizes.medium;\n};\n\n/**\n * Check if the user uses a medium size browser.\n * @returns {Bool} true if the body is smaller than Sizes.large max size.\n */\nconst isLarge = () => {\n    const DomRect = document.body.getBoundingClientRect();\n    return (DomRect.x + DomRect.width) <= Sizes.large;\n};\n\n/**\n * Activate the event listeners for this drawer.\n *\n * @param {DOMElement} pageDrawer the drawer\n * @param {DOMElement} toggleButton the button that toggles the drawer\n*/\nconst activateDrawer = (pageDrawer, toggleButton) => {\n    const closeButton = pageDrawer.querySelector('[data-action=\"closedrawer\"]');\n\n    if (!pageDrawer.classList.contains('show')) {\n        Aria.hide(pageDrawer);\n    }\n\n    toggleButton.addEventListener('click', () => {\n        if (pageDrawer.classList.contains('show')) {\n            closeDrawer(pageDrawer, toggleButton);\n            toggleButton.focus();\n        } else {\n            showDrawer(pageDrawer, toggleButton);\n            closeButton.focus();\n        }\n    });\n\n    if (closeButton) {\n        closeButton.addEventListener('click', () => {\n            closeDrawer(pageDrawer, toggleButton);\n            toggleButton.focus();\n        });\n    }\n\n    if (toggleButton.getAttribute('data-closeonresize')) {\n        window.addEventListener('resize', () => {\n            if (isLarge() && !isMedium()) {\n                closeDrawer(pageDrawer, toggleButton);\n            }\n        });\n    }\n\n    // Close drawer when another drawer opens.\n    document.addEventListener('show-boost-drawer', e => {\n        const trigger = pageDrawer.getAttribute('data-trigger');\n        if (trigger != e.detail && isLarge()) {\n            closeDrawer(pageDrawer, toggleButton, false);\n        }\n    });\n    pageDrawer.setAttribute('initialised', 'true');\n};\n\n/** Activate the scroller helper for the drawer layout\n */\nconst scroller = () => {\n    const body = document.querySelector('body');\n    const drawerLayout = document.querySelector('#page.drawers');\n    drawerLayout.addEventListener(\"scroll\", () => {\n        if (drawerLayout.scrollTop >= window.innerHeight) {\n            body.classList.add('scrolled');\n        } else {\n            body.classList.remove('scrolled');\n        }\n    });\n};\n\n/**\n * Activate all drawers for this page\n *\n * @param {String} drawer unique identifier for the drawer to toggle\n * @param {String} toggle unique identifier for the drawer toggle button\n */\nexport const init = () => {\n    scroller();\n    const drawers = document.querySelectorAll('[data-region=\"fixed-drawer\"]');\n    drawers.forEach((pageDrawer) => {\n        if (!pageDrawer.hasAttribute('initialised')) {\n            const trigger = pageDrawer.getAttribute('data-trigger');\n            if (trigger) {\n                const toggleButton = document.querySelector(`[data-action=\"${trigger}\"]`);\n                if (toggleButton) {\n                    activateDrawer(pageDrawer, toggleButton);\n                }\n            }\n        }\n    });\n};\n"],"file":"drawers.min.js"}