define ("core/local/reactive/reactive",["exports","core/log","core/local/reactive/statemanager"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=d(b);c=d(c);function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function f(a){return function(){var b=this,c=arguments;return new Promise(function(d,f){var i=a.apply(b,c);function g(a){e(i,d,f,g,h,"next",a)}function h(a){e(i,d,f,g,h,"throw",a)}g(void 0)})}}function g(a,b){return m(a)||l(a,b)||j(a,b)||h()}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function j(a,b){if(!a)return;if("string"==typeof a)return k(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return k(a,b)}function k(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function l(a,b){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(a)))return;var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function m(a){if(Array.isArray(a))return a}function n(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function o(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function p(a,b,c){if(b)o(a.prototype,b);if(c)o(a,c);return a}var q=function(){function a(b){var d,e;n(this,a);if(b.eventName===void 0||b.eventDispatch===void 0){throw new Error("Reactivity event required")}if(b.name!==void 0){this.name=b.name}this.target=null!==(d=b.target)&&void 0!==d?d:document.createTextNode(null);this.eventName=b.eventName;this.eventDispatch=b.eventDispatch;this.stateManager=new c.default(this.eventDispatch,this.target);this.watchers=new Map([]);this.components=new Set([]);this.mutations=null!==(e=b.mutations)&&void 0!==e?e:{};this.target.addEventListener(this.eventName,this.callWatchersHandler.bind(this));if(b.state!==void 0){this.setInitialState(b.state)}if(M.reactive!==void 0){M.reactive.registerNewInstance(this)}}p(a,[{key:"callWatchersHandler",value:function callWatchersHandler(a){this.target.dispatchEvent(new CustomEvent(a.detail.action,{bubbles:!1,detail:a.detail}))}},{key:"setInitialState",value:function setInitialState(a){this.stateManager.setInitialState(a)}},{key:"addMutations",value:function addMutations(a){if(a.init!==void 0){a.init(this.stateManager)}for(var b=0,c=Object.entries(a);b<c.length;b++){var d=g(c[b],2),e=d[0],f=d[1];this.mutations[e]=f.bind(a)}}},{key:"setMutations",value:function setMutations(a){this.mutations=a;if(a.init!==void 0){a.init(this.stateManager)}}},{key:"get",value:function get(a,b){return this.stateManager.get(a,b)}},{key:"getInitialStatePromise",value:function getInitialStatePromise(){return this.stateManager.getInitialPromise()}},{key:"registerComponent",value:function registerComponent(a){var c,d=this,e=null!==(c=a.name)&&void 0!==c?c:"Unkown component",f=function(){},g=f;if(a.dispatchRegistrationSuccess!==void 0){f=a.dispatchRegistrationSuccess.bind(a)}if(a.dispatchRegistrationFail!==void 0){g=a.dispatchRegistrationFail.bind(a)}if(this.components.has(a)){f();return a}var h=[],i=[];if(a.getWatchers!==void 0){i=a.getWatchers()}i.forEach(function(b){var c=b.watch,f=b.handler;if(c===void 0){g();throw new Error("Missing watch attribute in ".concat(e," watcher"))}if(f===void 0){g();throw new Error("Missing handler for watcher ".concat(c," in ").concat(e))}var i=function(b){f.apply(a,[b.detail])};h.push({target:d.target,watch:c,listener:i});d.target.addEventListener(c,i)});if(a.stateReady!==void 0){this.getInitialStatePromise().then(a.stateReady.bind(a)).catch(function(a){b.default.error("Initial state in ".concat(e," rejected due to: ").concat(a));b.default.error(a)})}this.watchers.set(a,h);this.components.add(a);this.target.dispatchEvent(new CustomEvent("registerComponent:success",{bubbles:!1,detail:{component:a}}));f();return a}},{key:"unregisterComponent",value:function unregisterComponent(a){if(!this.components.has(a)){return a}this.components.delete(a);var b=this.watchers.get(a);if(b===void 0){return a}b.forEach(function(a){var b=a.target,c=a.watch,d=a.listener;b.removeEventListener(c,d)});this.watchers.delete(a);return a}},{key:"dispatch",value:function(){var a=f(regeneratorRuntime.mark(function a(b){var c,d,e,f,g=arguments;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:if(!("string"!=typeof b)){a.next=2;break}throw new Error("Dispatch action name must be a string");case 2:if(!("_"===b.charAt(0))){a.next=4;break}throw new Error("Illegal Private ".concat(b," mutation method dispatch"));case 4:if(!(this.mutations[b]===void 0)){a.next=6;break}throw new Error("Unkown ".concat(b," mutation"));case 6:c=this.mutations[b];a.prev=7;for(d=g.length,e=Array(1<d?d-1:0),f=1;f<d;f++){e[f-1]=g[f]}a.next=11;return c.apply(this.mutations,[this.stateManager].concat(e));case 11:a.next=17;break;case 13:a.prev=13;a.t0=a["catch"](7);this.stateManager.setReadOnly(!0);throw a.t0;case 17:case"end":return a.stop();}}},a,this,[[7,13]])}));return function dispatch(){return a.apply(this,arguments)}}()},{key:"state",get:function get(){return this.stateManager.state}}]);return a}();a.default=q;return a.default});
//# sourceMappingURL=reactive.min.js.map
